{"ast":null,"code":"import * as XLSX from 'xlsx';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../service/usermainten/usermaintenance.service\";\nimport * as i2 from \"../../service/auth/auth.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"primeng/panel\";\nimport * as i5 from \"primeng/api\";\nimport * as i6 from \"primeng/table\";\nimport * as i7 from \"primeng/tag\";\nimport * as i8 from \"primeng/inputtext\";\nimport * as i9 from \"primeng/fileupload\";\nconst _c0 = [\"dt2\"];\nfunction UsermaintenanceComponent_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 7)(1, \"p-fileUpload\", 8);\n    i0.ɵɵlistener(\"uploadHandler\", function UsermaintenanceComponent_ng_template_3_Template_p_fileUpload_uploadHandler_1_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.onUpload($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"span\", 9);\n    i0.ɵɵelement(3, \"i\", 10);\n    i0.ɵɵelementStart(4, \"input\", 11);\n    i0.ɵɵlistener(\"input\", function UsermaintenanceComponent_ng_template_3_Template_input_input_4_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.filtrarTabla($event));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"auto\", true);\n  }\n}\nfunction UsermaintenanceComponent_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"th\", 12);\n    i0.ɵɵtext(2, \"Nombre de Usuario \");\n    i0.ɵɵelement(3, \"p-sortIcon\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"th\", 14);\n    i0.ɵɵtext(5, \"Correo \");\n    i0.ɵɵelement(6, \"p-sortIcon\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\", 16);\n    i0.ɵɵtext(8, \"Estado \");\n    i0.ɵɵelement(9, \"p-sortIcon\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\", 18);\n    i0.ɵɵtext(11, \"Intentos Fallidos \");\n    i0.ɵɵelement(12, \"p-sortIcon\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\", 20);\n    i0.ɵɵtext(14, \"Informaci\\u00F3n del Usuario \");\n    i0.ɵɵelement(15, \"p-sortIcon\", 21);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"colSpan\", 4);\n  }\n}\nfunction UsermaintenanceComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵelement(6, \"p-tag\", 22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵelement(8, \"p-tag\", 23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\")(10, \"div\")(11, \"p\")(12, \"b\");\n    i0.ɵɵtext(13, \"Identificaci\\u00F3n: \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"p\")(16, \"b\");\n    i0.ɵɵtext(17, \"Nombres: \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"p\")(20, \"b\");\n    i0.ɵɵtext(21, \"Fecha de Nacimiento: \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(22);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const user_r8 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(user_r8.userName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(user_r8.mail);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"value\", user_r8.status)(\"severity\", user_r8.status === \"Activo\" ? \"success\" : \"warning\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"value\", user_r8.intentoFallido);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(user_r8.personaByPersonaIdPersona2 == null ? null : user_r8.personaByPersonaIdPersona2.identificacion);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"\", (user_r8.personaByPersonaIdPersona2 == null ? null : user_r8.personaByPersonaIdPersona2.apellido) + \" \" + (user_r8.personaByPersonaIdPersona2 == null ? null : user_r8.personaByPersonaIdPersona2.nombres), \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(user_r8.personaByPersonaIdPersona2 == null ? null : user_r8.personaByPersonaIdPersona2.fechaNacimiento);\n  }\n}\nfunction UsermaintenanceComponent_ng_template_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 24);\n    i0.ɵɵtext(2, \"No se han cargado Usuarios.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nconst _c1 = function () {\n  return [10, 25, 50];\n};\nconst _c2 = function () {\n  return [\"userName\", \"mail\", \"status\", \"personaByPersonaIdPersona2.nombres\", \"personaByPersonaIdPersona2.apellido\", \"personaByPersonaIdPersona2.identificacion\"];\n};\nconst _c3 = function () {\n  return {\n    \"min-width\": \"75rem\"\n  };\n};\nexport class UsermaintenanceComponent {\n  constructor(usermaintenanceService, authService, router) {\n    this.usermaintenanceService = usermaintenanceService;\n    this.authService = authService;\n    this.router = router;\n    this.userDetails = null;\n    this.idUsuario = null;\n    this.usersList = [];\n    this.loading = false;\n  }\n  ngOnInit() {\n    this.loadUserDetails();\n    this.loadUsersList();\n  }\n  filtrarTabla(event) {\n    const valor = event.target.value;\n    this.dt2.filterGlobal(valor, 'contains');\n  }\n  loadUserDetails() {\n    if (this.authService.sessionExists()) {\n      const userInfo = this.authService.getDataUser();\n      this.userDetails = userInfo[0];\n      this.idUsuario = userInfo[1];\n    }\n  }\n  loadUsersList() {\n    this.loading = true;\n    this.usermaintenanceService.getUsuariosList(this.idUsuario).subscribe(users => {\n      this.usersList = users;\n      this.loading = false;\n    }, error => {\n      this.loading = false;\n      console.error('Error loading users list', error);\n      // Manejar el error aquí si es necesario\n    });\n  }\n\n  handleFileInput(file) {\n    const reader = new FileReader();\n    reader.onload = e => {\n      const data = new Uint8Array(e.target.result);\n      const workbook = XLSX.read(data, {\n        type: 'array'\n      });\n      const sheetName = workbook.SheetNames[0];\n      const worksheet = workbook.Sheets[sheetName];\n      const jsonData = XLSX.utils.sheet_to_json(worksheet, {\n        header: 1\n      });\n      jsonData.forEach(row => {\n        if (row.length === 0) {\n          console.log(\"Fila vacía, saltando...\");\n          return; // Saltar la iteración si la fila está vacía\n        }\n\n        console.log(\"Fila actual:\", row);\n        const usuario = {\n          userName: row[0],\n          mail: row[1],\n          password: row[2],\n          status: row[3],\n          intentoFallido: row[4],\n          personaByPersonaIdPersona2: {\n            identificacion: row[5],\n            apellido: row[6],\n            nombres: row[7],\n            idPersona: 0,\n            fechaNacimiento: row[8]\n          }\n        };\n        this.createUser(usuario);\n      });\n    };\n    reader.readAsArrayBuffer(file);\n  }\n  createUser(usuario) {\n    this.usermaintenanceService.createUser(usuario).subscribe(response => {\n      console.log('Usuario creado exitosamente:', response);\n      // Agrega esta línea para imprimir el usuario creado en la consola\n      console.log(usuario);\n    }, error => {\n      console.error('Error al crear el usuario:', error);\n    });\n  }\n  onUpload(event) {\n    const file = event.files[0];\n    if (file) {\n      this.handleFileInput(file);\n    }\n  }\n}\nUsermaintenanceComponent.ɵfac = function UsermaintenanceComponent_Factory(t) {\n  return new (t || UsermaintenanceComponent)(i0.ɵɵdirectiveInject(i1.UsermaintenanceService), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.Router));\n};\nUsermaintenanceComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: UsermaintenanceComponent,\n  selectors: [[\"app-usermaintenance\"]],\n  viewQuery: function UsermaintenanceComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.dt2 = _t.first);\n    }\n  },\n  decls: 7,\n  vars: 11,\n  consts: [[\"header\", \"Lista de Usuarios\"], [\"sortField\", \"userName\", \"sortMode\", \"single\", \"dataKey\", \"idUsuario\", \"currentPageReportTemplate\", \"Mostrando de {first} a {last} de {totalRecords} registros\", 3, \"value\", \"rows\", \"showCurrentPageReport\", \"rowsPerPageOptions\", \"loading\", \"paginator\", \"globalFilterFields\", \"tableStyle\"], [\"dt2\", \"\"], [\"pTemplate\", \"caption\"], [\"pTemplate\", \"header\"], [\"pTemplate\", \"body\"], [\"pTemplate\", \"emptymessage\"], [1, \"flex\"], [\"mode\", \"basic\", \"name\", \"demo\", \"accept\", \".csv,.xlsx\", \"styleClass\", \"p-button-success \", \"chooseIcon\", \"pi pi-upload\", \"chooseLabel\", \"Carga Masiva\", 3, \"auto\", \"uploadHandler\"], [1, \"p-input-icon-left\", \"ml-auto\"], [1, \"pi\", \"pi-search\"], [\"pInputText\", \"\", \"type\", \"text\", \"placeholder\", \"Buscar\", 3, \"input\"], [\"pSortableColumn\", \"userName\"], [\"field\", \"userName\"], [\"pSortableColumn\", \"mail\"], [\"field\", \"mail\"], [\"pSortableColumn\", \"status\"], [\"field\", \"status\"], [\"pSortableColumn\", \"intentoFallido\"], [\"field\", \"intentoFallido\"], [\"pSortableColumn\", \"personaByPersonaIdPersona2.apellido\", 3, \"colSpan\"], [\"field\", \"personaByPersonaIdPersona2.apellido\"], [3, \"value\", \"severity\"], [\"severity\", \"danger\", 3, \"value\"], [\"colspan\", \"5\"]],\n  template: function UsermaintenanceComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"p-panel\", 0)(1, \"p-table\", 1, 2);\n      i0.ɵɵtemplate(3, UsermaintenanceComponent_ng_template_3_Template, 5, 1, \"ng-template\", 3);\n      i0.ɵɵtemplate(4, UsermaintenanceComponent_ng_template_4_Template, 16, 1, \"ng-template\", 4);\n      i0.ɵɵtemplate(5, UsermaintenanceComponent_ng_template_5_Template, 23, 8, \"ng-template\", 5);\n      i0.ɵɵtemplate(6, UsermaintenanceComponent_ng_template_6_Template, 3, 0, \"ng-template\", 6);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"value\", ctx.usersList)(\"rows\", 10)(\"showCurrentPageReport\", true)(\"rowsPerPageOptions\", i0.ɵɵpureFunction0(8, _c1))(\"loading\", ctx.loading)(\"paginator\", true)(\"globalFilterFields\", i0.ɵɵpureFunction0(9, _c2))(\"tableStyle\", i0.ɵɵpureFunction0(10, _c3));\n    }\n  },\n  dependencies: [i4.Panel, i5.PrimeTemplate, i6.Table, i6.SortableColumn, i6.SortIcon, i7.Tag, i8.InputText, i9.FileUpload],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["XLSX","i0","UsermaintenanceComponent","constructor","usermaintenanceService","authService","router","ngOnInit","loadUserDetails","loadUsersList","filtrarTabla","event","valor","target","value","dt2","filterGlobal","sessionExists","userInfo","getDataUser","userDetails","idUsuario","loading","getUsuariosList","subscribe","users","usersList","error","console","handleFileInput","file","reader","FileReader","onload","e","data","Uint8Array","result","workbook","read","type","sheetName","SheetNames","worksheet","Sheets","jsonData","utils","sheet_to_json","header","forEach","row","length","log","usuario","userName","mail","password","status","intentoFallido","personaByPersonaIdPersona2","identificacion","apellido","nombres","idPersona","fechaNacimiento","createUser","readAsArrayBuffer","response","onUpload","files","selectors","viewQuery"],"sourceRoot":"","sources":["C:\\Users\\desta\\Downloads\\FrontEnd\\src\\app\\views\\usermaintenance\\usermaintenance.component.ts","C:\\Users\\desta\\Downloads\\FrontEnd\\src\\app\\views\\usermaintenance\\usermaintenance.component.html"],"sourcesContent":["import {Component, OnInit, ViewChild} from '@angular/core';\r\nimport {UserDetails} from \"../../models/user-details.model\";\r\nimport {AuthService} from \"../../service/auth/auth.service\";\r\nimport {Router} from \"@angular/router\";\r\nimport {UsermaintenanceService} from \"../../service/usermainten/usermaintenance.service\";\r\nimport * as XLSX from 'xlsx';\r\n\r\n@Component({\r\n    selector: 'app-usermaintenance',\r\n    templateUrl: './usermaintenance.component.html',\r\n    styleUrls: ['./usermaintenance.component.scss']\r\n})\r\nexport class UsermaintenanceComponent implements OnInit {\r\n    userDetails: UserDetails | null = null;\r\n    idUsuario: number | null = null;\r\n    usersList: UserDetails[] = [];\r\n    loading: boolean = false;\r\n\r\n    @ViewChild(\"dt2\") public dt2: any;\r\n\r\n    constructor(\r\n        private usermaintenanceService: UsermaintenanceService,\r\n        private authService: AuthService,\r\n        private router: Router\r\n    ) {\r\n    }\r\n\r\n    ngOnInit(): void {\r\n        this.loadUserDetails();\r\n        this.loadUsersList();\r\n    }\r\n\r\n    filtrarTabla(event: any) {\r\n        const valor = event.target.value;\r\n        this.dt2.filterGlobal(valor, 'contains');\r\n    }\r\n\r\n    loadUserDetails() {\r\n        if (this.authService.sessionExists()) {\r\n            const userInfo = this.authService.getDataUser()!;\r\n            this.userDetails = userInfo[0];\r\n            this.idUsuario = userInfo[1];\r\n        }\r\n    }\r\n\r\n    loadUsersList(): void {\r\n        this.loading = true;\r\n        this.usermaintenanceService.getUsuariosList(this.idUsuario!).subscribe(\r\n            (users: UserDetails[]) => {\r\n                this.usersList = users;\r\n                this.loading = false;\r\n            },\r\n            error => {\r\n                this.loading = false;\r\n                console.error('Error loading users list', error);\r\n                // Manejar el error aquí si es necesario\r\n            }\r\n        );\r\n    }\r\n    handleFileInput(file: File): void {\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = (e: any) => {\r\n            const data = new Uint8Array(e.target.result);\r\n            const workbook = XLSX.read(data, {type: 'array'});\r\n            const sheetName = workbook.SheetNames[0];\r\n            const worksheet = workbook.Sheets[sheetName];\r\n            const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});\r\n\r\n            jsonData.forEach((row: any) => {\r\n                if (row.length === 0) {\r\n                    console.log(\"Fila vacía, saltando...\");\r\n                    return; // Saltar la iteración si la fila está vacía\r\n                }\r\n                console.log(\"Fila actual:\", row);\r\n                const usuario: UserDetails = {\r\n                    userName: row[0],\r\n                    mail: row[1],\r\n                    password: row[2],\r\n                    status: row[3],\r\n                    intentoFallido: row[4],\r\n                    personaByPersonaIdPersona2: {\r\n                        identificacion: row[5],\r\n                        apellido: row[6],\r\n                        nombres: row[7],\r\n                        idPersona: 0,\r\n                        fechaNacimiento: row[8]\r\n                    }\r\n                } as UserDetails;\r\n\r\n                this.createUser(usuario);\r\n            });\r\n\r\n\r\n        };\r\n        reader.readAsArrayBuffer(file);\r\n    }\r\n    createUser(usuario: UserDetails): void {\r\n        this.usermaintenanceService.createUser(usuario).subscribe(\r\n            response => {\r\n                console.log('Usuario creado exitosamente:', response);\r\n                // Agrega esta línea para imprimir el usuario creado en la consola\r\n                console.log(usuario);\r\n            },\r\n            error => {\r\n                console.error('Error al crear el usuario:', error);\r\n            }\r\n        );\r\n    }\r\n\r\n    onUpload(event: any) {\r\n        const file = event.files[0];\r\n        if (file) {\r\n            this.handleFileInput(file);\r\n        }\r\n    }\r\n}\r\n","<!--<p-toast></p-toast>-->\r\n<p-panel header=\"Lista de Usuarios\">\r\n\r\n\r\n    <p-table\r\n        #dt2\r\n        [value]=\"usersList\"\r\n        sortField=\"userName\" sortMode=\"single\"\r\n        dataKey=\"idUsuario\"\r\n        [rows]=\"10\"\r\n        [showCurrentPageReport]=\"true\"\r\n        [rowsPerPageOptions]=\"[10, 25, 50]\"\r\n        [loading]=\"loading\"\r\n        [paginator]=\"true\"\r\n        currentPageReportTemplate=\"Mostrando de {first} a {last} de {totalRecords} registros\"\r\n        [globalFilterFields]=\"['userName', 'mail', 'status',\r\n            'personaByPersonaIdPersona2.nombres',\r\n            'personaByPersonaIdPersona2.apellido',\r\n            'personaByPersonaIdPersona2.identificacion']\"\r\n        [tableStyle]=\"{ 'min-width': '75rem' }\"\r\n    >\r\n        <ng-template pTemplate=\"caption\">\r\n            <div class=\"flex\">\r\n                <p-fileUpload mode=\"basic\" name=\"demo\"  accept=\".csv,.xlsx\" styleClass=\"p-button-success \"\r\n                              (uploadHandler)=\"onUpload($event)\"  [auto]=\"true\" chooseIcon=\"pi pi-upload\" chooseLabel=\"Carga Masiva\"></p-fileUpload>\r\n                <span class=\"p-input-icon-left ml-auto\">\r\n                    <i class=\"pi pi-search\"></i>\r\n                    <input pInputText type=\"text\" (input)=\"filtrarTabla($event)\" placeholder=\"Buscar\"/>\r\n                </span>\r\n            </div>\r\n        </ng-template>\r\n        <ng-template pTemplate=\"header\">\r\n            <tr>\r\n                <th pSortableColumn=\"userName\">Nombre de Usuario\r\n                    <p-sortIcon field=\"userName\"></p-sortIcon>\r\n                </th>\r\n                <th pSortableColumn=\"mail\">Correo\r\n                    <p-sortIcon field=\"mail\"></p-sortIcon>\r\n                </th>\r\n                <th pSortableColumn=\"status\">Estado\r\n                    <p-sortIcon field=\"status\"></p-sortIcon>\r\n                </th>\r\n                <th pSortableColumn=\"intentoFallido\">Intentos Fallidos\r\n                    <p-sortIcon field=\"intentoFallido\"></p-sortIcon>\r\n                </th>\r\n                <th [colSpan]=\"4\" pSortableColumn=\"personaByPersonaIdPersona2.apellido\">Información del Usuario\r\n                    <p-sortIcon field=\"personaByPersonaIdPersona2.apellido\"></p-sortIcon>\r\n                </th>\r\n            </tr>\r\n        </ng-template>\r\n        <ng-template pTemplate=\"body\" let-user>\r\n            <tr>\r\n                <td>{{user.userName}}</td>\r\n                <td>{{user.mail}}</td>\r\n                <td>\r\n                    <p-tag [value]=\"user.status\" [severity]=\"user.status === 'Activo' ? 'success' : 'warning'\"></p-tag>\r\n                </td>\r\n                <td>\r\n                    <p-tag [value]=\"user.intentoFallido\" severity=\"danger\"></p-tag>\r\n                </td>\r\n                <td>\r\n                    <div>\r\n                        <p><b>Identificación: </b>{{user.personaByPersonaIdPersona2?.identificacion}}</p>\r\n                        <p>\r\n                            <b>Nombres: </b>{{user.personaByPersonaIdPersona2?.apellido + ' ' + user.personaByPersonaIdPersona2?.nombres}}\r\n                        </p>\r\n                        <p><b>Fecha de Nacimiento: </b>{{user.personaByPersonaIdPersona2?.fechaNacimiento}}</p>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </ng-template>\r\n        <ng-template pTemplate=\"emptymessage\">\r\n            <tr>\r\n                <td colspan=\"5\">No se han cargado Usuarios.</td>\r\n            </tr>\r\n        </ng-template>\r\n    </p-table>\r\n</p-panel>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}